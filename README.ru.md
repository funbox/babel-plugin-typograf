# @funboxteam/babel-plugin-typograf

Babel-плагин для автоматического типографирования текста.

Для обработки текста плагин использует библиотеку [Typograf](https://github.com/typograf/typograf).  

Плагин выполняет поиск теговых шаблонов (tagged templates), помеченных специальным тегом:

```
T`"строка"`
```

Такие строки, после расстановки типографики, будут конвертированы в простые шаблонные строки (template literals):

```
`«строка»`
``` 

### Основные возможности Typograf

* Удаление лишних пробелов.
* Автоматическая расстановка неразрывных пробелов.
* Конвертация двойных кавычек в «ёлочки».
* Конвертация HTML-сущностей (`&nbsp;`, `&laquo;`, `&raquo;` и т.д.) в Unicode-символы.

### Правила Typograf

В typograf есть список правил, которые включены по умолчанию.  

Список всех правил можно посмотреть в [GitHub-репозитории библиотеки](https://github.com/typograf/typograf/blob/dev/docs/RULES.ru.md).

## Установка

`npm i -D @funboxteam/babel-plugin-typograf`

## Настройка

**Важно:**
В секции `plugins`, `babel-plugin-typograf` должен быть выше других плагинов которые работают с `template literals` (например `plugin-transform-template-literals`), чтобы конвертирование tagged templates в обычные template literals, было выполнено раньше.

После установки, необходимо добавить плагин в конфигурацию babel:

```js
plugins: [
  // ...
  ['@funboxteam/babel-plugin-typograf', {
     // Замена символов происходит с учётом локали
     locale: ['ru', 'en-US'],
     
     // Конвертация символов в HTML-сущности (по умолчанию отключена)
     htmlEntity: {
       type: 'name',        // Может быть name или digit
       onlyInvisible: true, // Конвертировать только невидимые символы
     },
     
     // Здесь можно включить дополнительные правила
     enableRules: [
       'common/nbsp/afterNumber',
     ],
     
     // Правила, которые включены по умолчанию в Typograf, можно отключить
     disableRules: [
       'common/punctuation/quote',
     ],
     
     // Настройки правил
     ruleSettings: [
       ['common/nbsp/beforeShortLastWord', 'lengthLastWord', 8],
     ],
  }],
]
```

## Использование

Для обозначения строк, в которые нужно добавить типографику, используется специальный tagged template:

```js
// Исходная строка
T`Отформатированная "строка".  `;

// Строка после обработки плагином
// Tagged Template с тегом T конвертируется в простой Template Literal
`Отформатированная «строка».`;
```

#### Не включать

Не рекомендуется включать правила:

* `ru/money/ruble` — правило преобразует все `руб.` в знак `₽`. Рекомендуется указывать знак `₽` точечно во избежание рисков комплексной автозамены там, где это может не потребоваться. Например, в динамических текстах, где необходимо будет указывать именно `руб.` и которые отследить заранее практически невозможно. Или в разметке, где требуется указать `руб.` в связи с тем, что знак `₽` корректно отображается не во всех используемых шрифтах и иногда требует использовать вместо знака изображение SVG.

* `common/space/delBeforePunctuation` — правило удаляет пробелы перед знаками препинания. Есть нюанс — например, фразу «Нам нужен .Net-разработчик.» преобразует в «Нам нужен.Net-разработчик.». На данный момент это решается только отключением правила, но, [возможно](https://github.com/typograf/typograf/issues/312), в будущем можно будет добавлять исключения.
 
